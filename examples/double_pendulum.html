<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>A Double Pendulum Example &mdash; Demo 0.4.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Demo 0.4.5 documentation" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
  
  <a href="https://github.com/ryan-roemer/sphinx-bootstrap-theme"
     class="visible-desktop hidden-xs"><img
    id="gh-banner"
    style="position: absolute; top: 50px; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
    alt="Fork me on GitHub"></a>
  <script>
    // Adjust banner height.
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
  </script>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Demo</a>
        <span class="navbar-text navbar-version pull-left"><b>0.4.5</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to the PyDy Wiki!</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation_general.html">General Installation Information</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../management/project_management.html">Project Management</a><ul class="simple">
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">A Double Pendulum Example</a><ul>
<li><a class="reference internal" href="#problem-description">Problem Description</a></li>
<li><a class="reference internal" href="#deriving-the-equations-of-motion-with-sympy">Deriving the equations of motion with SymPy</a></li>
<li><a class="reference internal" href="#integration-with-scipy">Integration with Scipy</a></li>
<li><a class="reference internal" href="#integration-with-matlab">Integration with Matlab</a></li>
<li><a class="reference internal" href="#simulating-with-c-c-gsl-plotting-with-matplotlib">Simulating with C/C++, GSL, plotting with matplotlib</a></li>
<li><a class="reference internal" href="#animation-with-matplotlib">Animation with Matplotlib</a></li>
<li><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/examples/double_pendulum.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="a-double-pendulum-example">
<h1>A Double Pendulum Example<a class="headerlink" href="#a-double-pendulum-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="problem-description">
<h2>Problem Description<a class="headerlink" href="#problem-description" title="Permalink to this headline">¶</a></h2>
<p>The double pendulum is a classic example of a chaotic system. It is a well
documented and understood example. Read [here](wp&gt;Double_pendulum) for more
details.</p>
<p>This example has 2 particles of the same mass, on massless links of the same
length.</p>
<a class="reference internal image-reference" href="../_images/double_pendulum.svg"><div align="center" class="align-center"><img height="500" src="../_images/double_pendulum.svg" width="500" /></div>
</a>
</div>
<div class="section" id="deriving-the-equations-of-motion-with-sympy">
<h2>Deriving the equations of motion with SymPy<a class="headerlink" href="#deriving-the-equations-of-motion-with-sympy" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span>
<span class="kn">from</span> <span class="nn">sympy.physics.mechanics</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">q1</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;q1 q2&#39;</span><span class="p">)</span>
<span class="n">q1d</span><span class="p">,</span> <span class="n">q2d</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;q1 q2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">u1</span><span class="p">,</span> <span class="n">u2</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;u1 u2&#39;</span><span class="p">)</span>
<span class="n">u1d</span><span class="p">,</span> <span class="n">u2d</span> <span class="o">=</span> <span class="n">dynamicsymbols</span><span class="p">(</span><span class="s">&#39;u1 u2&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s">&#39;l m g&#39;</span><span class="p">)</span>

<span class="n">N</span> <span class="o">=</span> <span class="n">ReferenceFrame</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">orientnew</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;Axis&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">q1</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">orientnew</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;Axis&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">q2</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>

<span class="n">A</span><span class="o">.</span><span class="n">set_ang_vel</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="n">B</span><span class="o">.</span><span class="n">set_ang_vel</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>

<span class="n">O</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">locatenew</span><span class="p">(</span><span class="s">&#39;P&#39;</span><span class="p">,</span> <span class="n">l</span> <span class="o">*</span> <span class="n">A</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">locatenew</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span> <span class="n">l</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

<span class="n">O</span><span class="o">.</span><span class="n">set_vel</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">P</span><span class="o">.</span><span class="n">v2pt_theory</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
<span class="n">R</span><span class="o">.</span><span class="n">v2pt_theory</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>

<span class="n">ParP</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="s">&#39;ParP&#39;</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">ParR</span> <span class="o">=</span> <span class="n">Particle</span><span class="p">(</span><span class="s">&#39;ParR&#39;</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="n">kd</span> <span class="o">=</span> <span class="p">[</span><span class="n">q1d</span> <span class="o">-</span> <span class="n">u1</span><span class="p">,</span> <span class="n">q2d</span> <span class="o">-</span> <span class="n">u2</span><span class="p">]</span>
<span class="n">FL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">P</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">x</span><span class="p">)]</span>
<span class="n">BL</span> <span class="o">=</span> <span class="p">[</span><span class="n">ParP</span><span class="p">,</span> <span class="n">ParR</span><span class="p">]</span>

<span class="n">KM</span> <span class="o">=</span> <span class="n">KanesMethod</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">q_ind</span><span class="o">=</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">],</span> <span class="n">u_ind</span><span class="o">=</span><span class="p">[</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">],</span> <span class="n">kd_eqs</span><span class="o">=</span><span class="n">kd</span><span class="p">)</span>

<span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">frstar</span><span class="p">)</span> <span class="o">=</span> <span class="n">KM</span><span class="o">.</span><span class="n">kanes_equations</span><span class="p">(</span><span class="n">FL</span><span class="p">,</span> <span class="n">BL</span><span class="p">)</span>
<span class="n">kdd</span> <span class="o">=</span> <span class="n">KM</span><span class="o">.</span><span class="n">kindiffdict</span><span class="p">()</span>
<span class="n">mm</span> <span class="o">=</span> <span class="n">KM</span><span class="o">.</span><span class="n">mass_matrix_full</span>
<span class="n">fo</span> <span class="o">=</span> <span class="n">KM</span><span class="o">.</span><span class="n">forcing_full</span>
<span class="n">qudots</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">inv</span><span class="p">()</span> <span class="o">*</span> <span class="n">fo</span>
<span class="n">qudots</span> <span class="o">=</span> <span class="n">qudots</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">kdd</span><span class="p">)</span>
<span class="n">qudots</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="n">mechanics_printing</span><span class="p">()</span>
<span class="n">mprint</span><span class="p">(</span><span class="n">qudots</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the above code will give the following python code output in the
console (order is , , ,
):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
<span class="p">[</span><span class="n">u2</span><span class="p">]</span>
<span class="p">[(</span><span class="o">-</span><span class="n">g</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">g</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">l</span><span class="o">*</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">l</span><span class="o">*</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">l</span><span class="o">*</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span><span class="o">*</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))]</span>
<span class="p">[(</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span><span class="o">*</span><span class="n">u2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">-</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">l</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span><span class="o">*</span><span class="n">u1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">-</span> <span class="n">l</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="p">)]</span>
</pre></div>
</div>
<p>These equations are the four first order differential equations that completely
described the systems motion at any time.</p>
</div>
<div class="section" id="integration-with-scipy">
<h2>Integration with Scipy<a class="headerlink" href="#integration-with-scipy" title="Permalink to this headline">¶</a></h2>
<p>These equations can also be computed with the SciPy libraries.</p>
<p>You can use the experimental code output function. This shows how the code
output would work for the double pendulum example. You can either put this at
the end of your script, or run it while in the interpreter.</p>
<p>You can supply a file name for the settings file, otherwise a default will be
provided. If an alternative settings file name is given, that will be the
default file name in the integration file. Note that once the settings file has
been written once, it does not need to be written again. Additionally, multiple
settings files can be written; the most recent one will be the default settings
file in the integration file.</p>
<p>You can either run the file from the interpreter, as &#8220;run outfile.py&#8221;, from the
command line as &#8220;python outfile.py&#8221;, or from the command line specifying a
settings file as &#8220;python outfile.py settings_file.csv&#8221;.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># append the following code to your script, or run it in the interpreter after you run your script</span>
    <span class="n">co</span> <span class="o">=</span> <span class="n">code_output</span><span class="p">(</span><span class="n">KM</span><span class="p">,</span> <span class="s">&quot;outfile&quot;</span><span class="p">)</span>
    <span class="n">co</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
    <span class="c"># output should be [m, g, l]</span>
    <span class="n">co</span><span class="o">.</span><span class="n">give_parameters</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">9.81</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">co</span><span class="o">.</span><span class="n">get_initialconditions</span><span class="p">()</span>
    <span class="c"># output should be [q1, q2, u1, u2]</span>
    <span class="n">co</span><span class="o">.</span><span class="n">give_initialconditions</span><span class="p">([</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="o">.</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">co</span><span class="o">.</span><span class="n">give_time_int</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>

    <span class="n">co</span><span class="o">.</span><span class="n">write_settings_file</span><span class="p">()</span>
    <span class="n">co</span><span class="o">.</span><span class="n">write_rhs_file</span><span class="p">(</span><span class="s">&#39;SciPy&#39;</span><span class="p">)</span>

    <span class="n">run</span> <span class="n">outfile</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/double_pendulum_scipy_plot.png"><img alt="../_images/double_pendulum_scipy_plot.png" class="align-center" src="../_images/double_pendulum_scipy_plot.png" style="width: 500px; height: 500px;" /></a>
</div>
<div class="section" id="integration-with-matlab">
<h2>Integration with Matlab<a class="headerlink" href="#integration-with-matlab" title="Permalink to this headline">¶</a></h2>
<p>A integration routine can be written in Matlab in a similar fashion as Scipy.
The syntax just varies slightly. The complete m-file can be downloaded from
[double_pendulum.m](https///github.com/gilbertgede/pydy_examples/blob/master/double_pendulum/double_pendulum.m).</p>
<p>The first step is to write the a function that returns the derivatives of the
states as a function of time and the current state:</p>
<div class="highlight-matlab"><div class="highlight"><pre><span class="k">function</span><span class="w"> </span>xd <span class="p">=</span><span class="w"> </span><span class="nf">state_derivatives</span><span class="p">(</span>t, x, m, l, g<span class="p">)</span><span class="w"></span>
<span class="c">%function xd = state_derivatives(t, x, m, l, g)</span>
<span class="c">% Returns the derivatives of the states as a function of the current state</span>
<span class="c">% and time.</span>
<span class="c">%</span>
<span class="c">% Parameters</span>
<span class="c">% ----------</span>
<span class="c">% t : double</span>
<span class="c">%   Current time.</span>
<span class="c">% x : vector, (4, 1)</span>
<span class="c">%   Current state.</span>
<span class="c">% m : double</span>
<span class="c">%   The mass of each particle.</span>
<span class="c">% l : double</span>
<span class="c">%   Length of each link.</span>
<span class="c">% g : double</span>
<span class="c">%   Acceleratoin due to gravity.</span>
<span class="c">%</span>
<span class="c">% Returns</span>
<span class="c">% -------</span>
<span class="c">% xd : matrix, 4 x 1</span>
<span class="c">%   The derivatives of the states in this order [q1, q2, u1, u2].</span>

<span class="c">% Unpack the variables so that you can use the sympy equations as is.</span>
<span class="n">q1</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">q2</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">u1</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="n">u2</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="c">% Initialize a vector for the derivatives.</span>
<span class="n">xd</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c">% Calculate the derivatives of the states. These equations can be copied</span>
<span class="c">% directly from the sympy output but be sure to print with `mprint` in</span>
<span class="c">% sympy.physics.mechanics to remove the `(t)` and use Matlab&#39;s find and</span>
<span class="c">% replace and regular expressions to change the python `**` to the matlab</span>
<span class="c">% `^`.</span>
<span class="n">xd</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">u1</span><span class="p">;</span>
<span class="n">xd</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">=</span> <span class="n">u2</span><span class="p">;</span>
<span class="n">xd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">g</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">u1</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">-</span> <span class="n">l</span> <span class="o">*</span> <span class="n">u1</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">u1</span>^<span class="mi">2</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">u1</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="c">...</span>
    <span class="n">l</span> <span class="o">*</span> <span class="n">u2</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span> <span class="o">*</span> <span class="n">u2</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span> <span class="o">/</span> <span class="c">...</span>
    <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">));</span>
<span class="n">xd</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="c">...</span>
    <span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span>^<span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span> <span class="o">*</span> <span class="n">u2</span>^<span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">l</span>^<span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">-</span> <span class="n">l</span>^<span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="c">...</span>
    <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">l</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">l</span>^<span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">))</span> <span class="o">*</span> <span class="n">u1</span>^<span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">l</span>^<span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="c">...</span>
    <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">*</span> <span class="nb">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">-</span> <span class="n">l</span>^<span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">);</span>
</pre></div>
</div>
<p>The equations of motion, xd, can be directly copied from the
sympy.mechanics.physics output above, except that you must change the power
operator, &#8216;**&#8217;, from python to the power operator used in Matlab, &#8216;^&#8217;.</p>
<p>You now can use one of Matlab&#8217;s built-in ode integration routines, such as
ode45, to integrate the equations of motion and get the time histories of the
states.</p>
<div class="highlight-matlab"><div class="highlight"><pre><span class="c">% Integrate the equations over from 0 to 5 seconds with 50 steps.</span>
<span class="n">timeSpan</span> <span class="p">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>

<span class="c">% Set initial angles in radians and the initial speeds to zero.</span>
<span class="n">initialConditions</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">];</span>

<span class="c">% Define particles&#39; mass, pendulums&#39; length, and the acceleration due to</span>
<span class="c">% gravity.</span>
<span class="n">m</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="n">l</span> <span class="p">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="n">g</span> <span class="p">=</span> <span class="mf">9.8</span><span class="p">;</span>

<span class="c">% Create a function handle to an anonymous function which which can pass the</span>
<span class="c">% parameters.</span>
<span class="n">f</span> <span class="p">=</span> <span class="p">@(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="n">state_derivatives</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>

<span class="c">% Integrate the equations of motion with default integration settings.</span>
<span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="p">=</span> <span class="n">ode45</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">timeSpan</span><span class="p">,</span> <span class="n">initialConditions</span><span class="p">);</span>
</pre></div>
</div>
<p>The states as a function of time are now available. Use Matlab&#8217;s plotting functions to visualize the motion.</p>
<div class="highlight-matlab"><div class="highlight"><pre><span class="c">% Plot the results.</span>
<span class="n">fig</span> <span class="p">=</span> <span class="n">figure</span><span class="p">();</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Double pendulum states as a function of time&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [s]&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;q1 [rad]&#39;</span><span class="p">,</span> <span class="s">&#39;q2 [rad]&#39;</span><span class="p">,</span> <span class="s">&#39;u1 [rad/s]&#39;</span><span class="p">,</span> <span class="s">&#39;u2 [rad/s]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/double_pendulum_matlab_plot.png"><img alt="../_images/double_pendulum_matlab_plot.png" class="align-center" src="../_images/double_pendulum_matlab_plot.png" style="width: 500px; height: 500px;" /></a>
</div>
<div class="section" id="simulating-with-c-c-gsl-plotting-with-matplotlib">
<h2>Simulating with C/C++, <a class="reference external" href="http://www.gnu.org/s/gsl/manual/html_node/">GSL</a>, plotting with <a class="reference external" href="http://matplotlib.sourceforge.net/">matplotlib</a><a class="headerlink" href="#simulating-with-c-c-gsl-plotting-with-matplotlib" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is useful, for performance reasons, to write the main numerical
part of your code in a compiled language like C, C++, or Fortran.  This example
illustrates how to do the main part of the simulation in C++, but then do the
plotting with matplotlib.</p>
<p><strong>double_pendulum.h</strong></p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#ifndef DOUBLE_PENDULUM_H</span>

<span class="cp">#define DOUBLE_PENDULUM_H</span>
<span class="kt">double</span> <span class="nf">double_pendulum_ke</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="kt">double</span> <span class="nf">double_pendulum_pe</span><span class="p">(</span><span class="k">const</span> <span class="kt">double</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="kt">int</span> <span class="nf">double_pendulum_ode</span><span class="p">(</span><span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">x</span><span class="p">[],</span> <span class="kt">double</span> <span class="n">dxdt</span><span class="p">[],</span> <span class="kt">void</span> <span class="o">*</span><span class="n">_params</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>The SymPy function ccode() is a very handy way to take a sympy expression and
convert it to a C statement that will compile.  Using this function, we can
form the ODE function, as well as kinetic and potential energy functions for
the double pendulum.  All of the functions in the following file were obtained
by a simple copy/paste of the output of the ccode() function in Sympy.</p>
<p><strong>double_pendulum.cc</strong></p>
<div class="highlight-c"><div class="highlight"><pre>#include &quot;double_pendulum.h&quot;

#include `&lt;cmath&gt;`
#include `&lt;gsl/gsl_errno.h&gt;`

#include `&lt;gsl/gsl_odeiv2.h&gt;`

double double_pendulum_ke(const double x[4], const double params[3])
{
    double m = params[0], l = params[2];
    return 1.0*pow(l, 2)*(sin(x[0])*sin(x[1]) + cos(x[0])*cos(x[1]))*x[2]*x[3]/m + 1.0*pow(l, 2)*pow(x[2], 2)/m + 0.5*pow(l, 2)*pow(x[3], 2)/m;
}

double double_pendulum_pe(const double x[4], const double params[3])
{
    double m = params[0], g = params[1], l = params[2];
    return -g*m*(2*l*cos(x[0]) + l*cos(x[1]) - 3*l);
}

int double_pendulum_ode(double t, const double x[], double dxdt[], void *_params)
{
    double const *params = static_cast`&lt;double const *&gt;`(_params);
    double m = params[0], g = params[1], l = params[2];
    dxdt[0] = x[2];
    dxdt[1] = x[3];
    dxdt[2] = (-g*sin(x[0])*pow(sin(x[1]), 2) + 2*g*sin(x[0]) - g*sin(x[1])*cos(x[0])*cos(x[1]) + 2*l*pow(x[2], 2)*sin(x[0])*cos(x[0])*pow(cos(x[1]), 2) - l*pow(x[2], 2)*sin(x[0])*cos(x[0]) - 2*l*pow(x[2], 2)*sin(x[1])*pow(cos(x[0]), 2)*cos(x[1]) + l*pow(x[2], 2)*sin(x[1])*cos(x[1]) + l*pow(x[3], 2)*sin(x[0])*cos(x[1]) - l*pow(x[3], 2)*sin(x[1])*cos(x[0]))/(l*(pow(sin(x[0]), 2)*pow(sin(x[1]), 2) + 2*sin(x[0])*sin(x[1])*cos(x[0])*cos(x[1]) + pow(cos(x[0]), 2)*pow(cos(x[1]), 2) - 2)) ;
    dxdt[3] = (-sin(x[0])*sin(x[1])/2 - cos(x[0])*cos(x[1])/2)*(2*g*l*m*sin(x[0]) - pow(l, 2)*m*(-sin(x[0])*cos(x[1]) + sin(x[1])*cos(x[0]))*pow(x[3], 2))/(pow(l, 2)*m*(sin(x[0])*sin(x[1])/2 + cos(x[0])*cos(x[1])/2)*(sin(x[0])*sin(x[1]) + cos(x[0])*cos(x[1])) - pow(l, 2)*m) + (g*l*m*sin(x[1]) - pow(l, 2)*m*(sin(x[0])*cos(x[1]) - sin(x[1])*cos(x[0]))*pow(x[2], 2))/(pow(l, 2)*m*(sin(x[0])*sin(x[1])/2 + cos(x[0])*cos(x[1])/2)*(sin(x[0])*sin(x[1]) + cos(x[0])*cos(x[1])) - pow(l, 2)*m);
    return GSL_SUCCESS;
}
</pre></div>
</div>
<p>To numerically integrate the equations, and save the time history of the states
and energies to a data file, our main driver is as follows:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include `&lt;fstream&gt;`</span>

<span class="cp">#include `&lt;gsl/gsl_odeiv2.h&gt;`</span>
<span class="cp">#include &quot;double_pendulum.h&quot;</span>

<span class="k">struct</span> <span class="n">simdata</span> <span class="p">{</span> <span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">pe</span><span class="p">,</span> <span class="n">ke</span><span class="p">;</span> <span class="p">};</span>       <span class="c1">// t, q1, q2, u1, u2, pe, ke</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">params</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">9.81</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">};</span>             <span class="c1">// m, g, l</span>
    <span class="n">simdata</span> <span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0</span><span class="p">,</span> <span class="p">{</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">}};</span>        <span class="c1">// initial time and state</span>
    <span class="n">s</span><span class="p">.</span><span class="n">ke</span> <span class="o">=</span> <span class="n">double_pendulum_ke</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>         <span class="c1">// initial kinetic energy</span>
    <span class="n">s</span><span class="p">.</span><span class="n">pe</span> <span class="o">=</span> <span class="n">double_pendulum_pe</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>         <span class="c1">// intial potential energy</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">tf</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span>                          <span class="c1">// final time</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">501</span><span class="p">;</span>                              <span class="c1">// number of points</span>

    <span class="c1">// GSL setup code</span>
    <span class="n">gsl_odeiv2_system</span> <span class="n">sys</span> <span class="o">=</span> <span class="p">{</span><span class="n">double_pendulum_ode</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">params</span><span class="p">};</span>
    <span class="n">gsl_odeiv2_driver</span> <span class="o">*</span> <span class="n">d</span> <span class="o">=</span> <span class="n">gsl_odeiv2_driver_alloc_y_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sys</span><span class="p">,</span> <span class="n">gsl_odeiv2_step_rk8pd</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="c1">// Open a file for writing</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">f</span><span class="p">(</span><span class="s">&quot;datafile.dat&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span> <span class="o">|</span> <span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">out</span><span class="p">);</span>

    <span class="c1">// Simulation loop</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">simdata</span><span class="p">));</span>          <span class="c1">// Write initial time data</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">ti</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">tf</span> <span class="o">/</span> <span class="n">N</span><span class="p">;</span>
    <span class="n">gsl_odeiv2_driver_apply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">t</span><span class="p">),</span> <span class="n">ti</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>  <span class="c1">// integrate the ODE&#39;s</span>
    <span class="n">s</span><span class="p">.</span><span class="n">ke</span> <span class="o">=</span> <span class="n">double_pendulum_ke</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>       <span class="c1">// compute kinetic energy</span>
    <span class="n">s</span><span class="p">.</span><span class="n">pe</span> <span class="o">=</span> <span class="n">double_pendulum_pe</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>       <span class="c1">// compute potential energy</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">simdata</span><span class="p">));</span>        <span class="c1">// write to file</span>
    <span class="p">}</span>

    <span class="n">gsl_odeiv2_driver_free</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>                      <span class="c1">// free resources</span>
    <span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>                                      <span class="c1">// close file</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When you run this, a binary data file will be created in your current working
directory.  You can plot the data with the following Python code that makes use
of Matplotlib:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c"># Define a data type for the simdata structure</span>
<span class="n">simdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;q1&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;q2&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;u1&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;u2&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;pe&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;ke&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)])</span>

<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;./double_pendulum_sim&#39;</span><span class="p">)</span>                <span class="c"># run the simulation</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="s">&#39;datafile.dat&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">simdata</span><span class="p">)</span> <span class="c"># read the data</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;q1&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$q_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;q2&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$q_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;u1&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$u_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;u2&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$u_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;ke&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$ke$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;pe&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$pe$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;pe&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;ke&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$ke+pe$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Which results in the following nice plot:</p>
<a class="reference internal image-reference" href="../_images/double_pendulum_plot.png"><img alt="../_images/double_pendulum_plot.png" class="align-center" src="../_images/double_pendulum_plot.png" style="width: 500px; height: 500px;" /></a>
</div>
<div class="section" id="animation-with-matplotlib">
<h2>Animation with Matplotlib<a class="headerlink" href="#animation-with-matplotlib" title="Permalink to this headline">¶</a></h2>
<p>Matplotlib 1.1 has an animation module that makes 2D animation easy. Check out
this tutorial for animating a double pendulum:</p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=32cjc6V0OZY">Matplotlib animation</a></p>
<p><a class="reference external" href="http://matplotlib.sourceforge.net/examples/animation/double_pendulum_animated.html">Double pendulum animation Code</a></p>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p>All of the source code for the examples can be found in
<a class="reference external" href="https://github.com/gilbertgede/pydy_examples">https://github.com/gilbertgede/pydy_examples</a>.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011-2014, Ryan Roemer.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>